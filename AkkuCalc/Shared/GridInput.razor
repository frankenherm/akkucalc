@using AkkuCalc.Model
@using AkkuCalc.Services

@inject NumberPartitioningService NumberPartitioningService
@inject IJSRuntime JSRuntime

<h3>GridInput</h3>

<EditForm class="vstack" Model="Capacity" OnValidSubmit="SubmitAsync">
    <DataAnnotationsValidator></DataAnnotationsValidator>
    <label class="form-label" for="input">weitere Zelle hinzufügen: </label>
    <InputNumber id="input-element-primary" class="form-control" 
        @bind-Value="Capacity.Value" 
        @ref="inputElement"></InputNumber>
</EditForm>

<div class="row">
    <div class="col">
        <input id="subset-numbers" class="form-control my-3" @bind-value="NumberPartitioningService.NumberOfSubsets" />
    </div>
    <div class="col oi-vertical-align-center">
        <button class="btn btn-primary" @onclick="Calculate">Calculate</button>
    </div>
</div>


@code {
    private InputNumber<float> inputElement;

    private CellCapacity Capacity { get; set; } = new CellCapacity();
    private Task SubmitAsync()
    {
        this.NumberPartitioningService.Add(Capacity.Value);
        Capacity = new AkkuCalc.Model.CellCapacity();
        return Task.CompletedTask;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (inputElement.Element.HasValue)
        {
            await inputElement.Element.Value.FocusAsync(true);
            await Select();
        }
        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task Select()
    {
        await JSRuntime.InvokeVoidAsync("selectText", "input-element-primary");
    }

    private void Calculate()
    {
        this.NumberPartitioningService.DoPartition();
    }
}
